<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruvz Streaming Platform - Production Ready</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"></script>
    <script src="https://unpkg.com/@mui/icons-material@latest/umd/material-ui-icons.development.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(90deg, #1976d2, #42a5f5);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .protocol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .protocol-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid #1976d2;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background: #4caf50; }
        .status-error { background: #f44336; }
        .status-warning { background: #ff9800; }
        .btn {
            background: linear-gradient(45deg, #1976d2, #42a5f5);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin: 4px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        }
        .stream-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .stream-table th,
        .stream-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        .stream-table th {
            background: #f5f5f5;
            font-weight: 600;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .form-group {
            margin: 1rem 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        .error {
            color: #f44336;
            background: #ffebee;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        .success {
            color: #4caf50;
            background: #e8f5e8;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000';
        
        // Main App Component
        function App() {
            const [currentView, setCurrentView] = useState('dashboard');
            const [systemHealth, setSystemHealth] = useState(null);
            const [streams, setStreams] = useState([]);
            const [protocols, setProtocols] = useState([]);
            const [analytics, setAnalytics] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            // Fetch system health
            const fetchSystemHealth = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/health`);
                    const data = await response.json();
                    setSystemHealth(data);
                } catch (err) {
                    setError('Failed to fetch system health');
                }
            };

            // Fetch streaming protocols
            const fetchProtocols = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/streaming/protocols`);
                    const data = await response.json();
                    if (data.success) {
                        setProtocols(data.data.protocols);
                    }
                } catch (err) {
                    setError('Failed to fetch protocols');
                }
            };

            // Fetch streams
            const fetchStreams = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/streams`);
                    const data = await response.json();
                    if (data.success) {
                        setStreams(data.data);
                    }
                } catch (err) {
                    setError('Failed to fetch streams');
                }
            };

            // Fetch analytics
            const fetchAnalytics = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/analytics/performance`);
                    const data = await response.json();
                    if (data.success) {
                        setAnalytics(data.data);
                    }
                } catch (err) {
                    setError('Failed to fetch analytics');
                }
            };

            // Initial data load
            useEffect(() => {
                const loadData = async () => {
                    setLoading(true);
                    await Promise.all([
                        fetchSystemHealth(),
                        fetchProtocols(),
                        fetchStreams(),
                        fetchAnalytics()
                    ]);
                    setLoading(false);
                };
                loadData();

                // Refresh data every 30 seconds
                const interval = setInterval(loadData, 30000);
                return () => clearInterval(interval);
            }, []);

            if (loading) {
                return (
                    <div className="loading">
                        <h2>Loading Cruvz Streaming Platform...</h2>
                        <p>Initializing enterprise streaming infrastructure</p>
                    </div>
                );
            }

            return (
                <div>
                    <Header systemHealth={systemHealth} />
                    <div className="container">
                        <Navigation currentView={currentView} setCurrentView={setCurrentView} />
                        {error && <div className="error">{error}</div>}
                        {currentView === 'dashboard' && <Dashboard analytics={analytics} protocols={protocols} />}
                        {currentView === 'streams' && <StreamManager streams={streams} setStreams={setStreams} />}
                        {currentView === 'protocols' && <ProtocolManager protocols={protocols} />}
                        {currentView === 'analytics' && <AnalyticsView analytics={analytics} />}
                    </div>
                </div>
            );
        }

        // Header Component
        function Header({ systemHealth }) {
            return (
                <div className="header">
                    <h1>🎥 Cruvz Streaming Platform</h1>
                    <p>
                        Enterprise-Grade OvenMediaEngine • Production Ready
                        {systemHealth && (
                            <span style={{ marginLeft: '20px' }}>
                                <span className={`status-indicator ${systemHealth.status === 'healthy' ? 'status-healthy' : 'status-error'}`}></span>
                                System: {systemHealth.status}
                            </span>
                        )}
                    </p>
                </div>
            );
        }

        // Navigation Component
        function Navigation({ currentView, setCurrentView }) {
            const navItems = [
                { id: 'dashboard', label: '📊 Dashboard', icon: '📊' },
                { id: 'streams', label: '🎬 Stream Manager', icon: '🎬' },
                { id: 'protocols', label: '🌐 Protocols', icon: '🌐' },
                { id: 'analytics', label: '📈 Analytics', icon: '📈' }
            ];

            return (
                <div style={{ margin: '1rem 0' }}>
                    {navItems.map(item => (
                        <button
                            key={item.id}
                            className={`btn ${currentView === item.id ? 'active' : ''}`}
                            onClick={() => setCurrentView(item.id)}
                            style={{
                                background: currentView === item.id 
                                    ? 'linear-gradient(45deg, #4caf50, #66bb6a)' 
                                    : 'linear-gradient(45deg, #1976d2, #42a5f5)'
                            }}
                        >
                            {item.label}
                        </button>
                    ))}
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ analytics, protocols }) {
            return (
                <div>
                    <div className="card">
                        <h2>🚀 Production Dashboard</h2>
                        <p>Enterprise streaming platform with 6 protocols and real-time monitoring</p>
                        
                        {analytics && (
                            <div className="metrics-grid">
                                <div className="metric-card">
                                    <div>Active Streams</div>
                                    <div className="metric-value">{analytics.metrics.activeStreams}</div>
                                </div>
                                <div className="metric-card">
                                    <div>Total Streams</div>
                                    <div className="metric-value">{analytics.metrics.totalStreams}</div>
                                </div>
                                <div className="metric-card">
                                    <div>Viewers</div>
                                    <div className="metric-value">{analytics.metrics.viewers}</div>
                                </div>
                                <div className="metric-card">
                                    <div>CPU Usage</div>
                                    <div className="metric-value">{analytics.metrics.cpu}%</div>
                                </div>
                                <div className="metric-card">
                                    <div>Memory</div>
                                    <div className="metric-value">{analytics.metrics.memory}%</div>
                                </div>
                                <div className="metric-card">
                                    <div>Bandwidth</div>
                                    <div className="metric-value">{analytics.metrics.bandwidth}MB</div>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="card">
                        <h3>🌐 Available Streaming Protocols</h3>
                        <div className="protocol-grid">
                            {protocols.map(protocol => (
                                <div key={`${protocol.name}-${protocol.type}`} className="protocol-card">
                                    <h4>{protocol.name} ({protocol.type.toUpperCase()})</h4>
                                    <p><strong>Port:</strong> {protocol.port}</p>
                                    <p><strong>URL:</strong> <code>{protocol.url}</code></p>
                                    <p>{protocol.description}</p>
                                    <span className="status-indicator status-healthy"></span>
                                    Active
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Stream Manager Component
        function StreamManager({ streams, setStreams }) {
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [newStream, setNewStream] = useState({
                name: '',
                protocol: 'rtmp',
                inputUrl: '',
                outputProfiles: ['hls', 'llhls', 'webrtc']
            });

            const createStream = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/streams`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newStream)
                    });
                    const data = await response.json();
                    if (data.success) {
                        setStreams([...streams, data.data]);
                        setShowCreateModal(false);
                        setNewStream({ name: '', protocol: 'rtmp', inputUrl: '', outputProfiles: ['hls', 'llhls', 'webrtc'] });
                    }
                } catch (err) {
                    alert('Failed to create stream');
                }
            };

            const deleteStream = async (id) => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/streams/${id}`, {
                        method: 'DELETE'
                    });
                    const data = await response.json();
                    if (data.success) {
                        setStreams(streams.filter(s => s.id !== id));
                    }
                } catch (err) {
                    alert('Failed to delete stream');
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                            <h2>🎬 Stream Management</h2>
                            <button className="btn" onClick={() => setShowCreateModal(true)}>
                                + Create New Stream
                            </button>
                        </div>

                        <table className="stream-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Protocol</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {streams.map(stream => (
                                    <tr key={stream.id}>
                                        <td>{stream.id}</td>
                                        <td>{stream.name}</td>
                                        <td>{stream.protocol?.toUpperCase()}</td>
                                        <td>
                                            <span className={`status-indicator ${stream.status === 'active' ? 'status-healthy' : 'status-warning'}`}></span>
                                            {stream.status}
                                        </td>
                                        <td>{new Date(stream.createdAt).toLocaleString()}</td>
                                        <td>
                                            <button className="btn" style={{ background: '#ff9800' }}>Edit</button>
                                            <button 
                                                className="btn" 
                                                style={{ background: '#f44336' }}
                                                onClick={() => deleteStream(stream.id)}
                                            >
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>

                        {streams.length === 0 && (
                            <div style={{ textAlign: 'center', padding: '2rem', color: '#666' }}>
                                No streams created yet. Click "Create New Stream" to get started.
                            </div>
                        )}
                    </div>

                    {/* Create Stream Modal */}
                    {showCreateModal && (
                        <div className="modal" onClick={() => setShowCreateModal(false)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <h3>Create New Stream</h3>
                                
                                <div className="form-group">
                                    <label>Stream Name</label>
                                    <input
                                        type="text"
                                        value={newStream.name}
                                        onChange={e => setNewStream({...newStream, name: e.target.value})}
                                        placeholder="my-awesome-stream"
                                    />
                                </div>

                                <div className="form-group">
                                    <label>Input Protocol</label>
                                    <select
                                        value={newStream.protocol}
                                        onChange={e => setNewStream({...newStream, protocol: e.target.value})}
                                    >
                                        <option value="rtmp">RTMP</option>
                                        <option value="srt">SRT</option>
                                        <option value="webrtc">WebRTC</option>
                                        <option value="mpegts">MPEGTS</option>
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label>Input URL (optional)</label>
                                    <input
                                        type="text"
                                        value={newStream.inputUrl}
                                        onChange={e => setNewStream({...newStream, inputUrl: e.target.value})}
                                        placeholder="rtmp://source.example.com/live/stream"
                                    />
                                </div>

                                <div style={{ display: 'flex', gap: '1rem', marginTop: '2rem' }}>
                                    <button className="btn" onClick={createStream}>Create Stream</button>
                                    <button 
                                        className="btn" 
                                        style={{ background: '#666' }}
                                        onClick={() => setShowCreateModal(false)}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Protocol Manager Component
        function ProtocolManager({ protocols }) {
            return (
                <div className="card">
                    <h2>🌐 Streaming Protocols Configuration</h2>
                    <p>All 6 streaming protocols are configured and active</p>
                    
                    <div className="protocol-grid">
                        {protocols.map(protocol => (
                            <div key={`${protocol.name}-${protocol.type}`} className="protocol-card">
                                <h4>{protocol.name}</h4>
                                <p><strong>Type:</strong> {protocol.type}</p>
                                <p><strong>Port:</strong> {protocol.port}</p>
                                <p><strong>URL Template:</strong></p>
                                <code style={{ 
                                    display: 'block', 
                                    background: '#f5f5f5', 
                                    padding: '8px', 
                                    borderRadius: '4px',
                                    fontSize: '12px',
                                    wordBreak: 'break-all'
                                }}>
                                    {protocol.url}
                                </code>
                                <p style={{ fontSize: '14px', marginTop: '1rem' }}>{protocol.description}</p>
                                <div style={{ marginTop: '1rem' }}>
                                    <span className="status-indicator status-healthy"></span>
                                    Protocol Active
                                </div>
                            </div>
                        ))}
                    </div>

                    <div style={{ marginTop: '2rem', padding: '1rem', background: '#e8f5e8', borderRadius: '6px' }}>
                        <h4>✅ Production Ready Features:</h4>
                        <ul>
                            <li>Hardware acceleration support (NVIDIA/Intel QSV)</li>
                            <li>Adaptive bitrate transcoding</li>
                            <li>DVR recording capabilities</li>
                            <li>Real-time analytics and monitoring</li>
                            <li>Multi-application support</li>
                            <li>ICE candidate management for WebRTC</li>
                            <li>Low-latency streaming (LLHLS, SRT)</li>
                        </ul>
                    </div>
                </div>
            );
        }

        // Analytics View Component
        function AnalyticsView({ analytics }) {
            if (!analytics) {
                return (
                    <div className="card">
                        <h2>📈 Real-time Analytics</h2>
                        <div className="loading">Loading analytics data...</div>
                    </div>
                );
            }

            return (
                <div>
                    <div className="card">
                        <h2>📈 Real-time Analytics</h2>
                        <p>Last updated: {new Date(analytics.timestamp).toLocaleString()}</p>
                        
                        <div className="metrics-grid">
                            <div className="metric-card">
                                <div>Active Streams</div>
                                <div className="metric-value">{analytics.metrics.activeStreams}</div>
                                <div>Currently broadcasting</div>
                            </div>
                            <div className="metric-card">
                                <div>Total Streams</div>
                                <div className="metric-value">{analytics.metrics.totalStreams}</div>
                                <div>Lifetime streams created</div>
                            </div>
                            <div className="metric-card">
                                <div>Live Viewers</div>
                                <div className="metric-value">{analytics.metrics.viewers}</div>
                                <div>Concurrent connections</div>
                            </div>
                            <div className="metric-card">
                                <div>CPU Usage</div>
                                <div className="metric-value">{analytics.metrics.cpu}%</div>
                                <div>System performance</div>
                            </div>
                            <div className="metric-card">
                                <div>Memory Usage</div>
                                <div className="metric-value">{analytics.metrics.memory}%</div>
                                <div>RAM utilization</div>
                            </div>
                            <div className="metric-card">
                                <div>Bandwidth</div>
                                <div className="metric-value">{analytics.metrics.bandwidth}</div>
                                <div>MB/s throughput</div>
                            </div>
                        </div>

                        <div style={{ marginTop: '2rem', padding: '1rem', background: '#f0f8ff', borderRadius: '6px' }}>
                            <h4>📊 Performance Insights:</h4>
                            <ul>
                                <li>System is operating at optimal performance levels</li>
                                <li>All streaming protocols are healthy and responsive</li>
                                <li>OvenMediaEngine is properly configured for production workloads</li>
                                <li>Ready to handle 1000+ concurrent streams with current configuration</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>