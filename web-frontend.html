<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruvz-SRT Production Streaming Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }
        .header h1 {
            color: #4A90E2;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        .section { 
            background: rgba(255,255,255,0.95); 
            padding: 25px; 
            margin: 20px 0; 
            border-radius: 15px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        .section h2 {
            color: #4A90E2;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #E0E6ED;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input, button, textarea, select { 
            width: 100%;
            margin: 5px 0; 
            padding: 12px; 
            border: 2px solid #E0E6ED;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        button { 
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover { 
            background: linear-gradient(135deg, #357ABD 0%, #2968A3 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .result { 
            background: #f8f9fa; 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid #E0E6ED;
            min-height: 20px;
        }
        .success { 
            color: #28a745; 
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error { 
            color: #dc3545; 
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .info { 
            color: #17a2b8; 
            border-left-color: #17a2b8;
            background: #d1ecf1;
        }
        .warning {
            color: #856404;
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .streaming-urls { 
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f9ff 100%); 
            padding: 20px; 
            border-radius: 10px; 
            margin: 15px 0; 
            border: 1px solid #B3D4FC;
        }
        .url-box { 
            background: #fff; 
            padding: 12px; 
            margin: 8px 0; 
            font-family: 'Courier New', monospace; 
            border: 1px solid #ddd; 
            border-radius: 6px;
            position: relative;
            font-size: 13px;
        }
        .url-box .label {
            font-weight: bold;
            color: #4A90E2;
            margin-bottom: 5px;
        }
        .copy-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #4A90E2;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            width: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .metric-card {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #E0E6ED;
        }
        .metric-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #4A90E2;
        }
        .metric-card .label {
            color: #666;
            margin-top: 5px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4A90E2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .auth-section {
            display: none;
        }
        .auth-section.active {
            display: block;
        }
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
        }
        .tab-btn.active {
            background: #4A90E2;
            color: white;
        }
        .tab-btn:first-child {
            border-radius: 8px 0 0 8px;
        }
        .tab-btn:last-child {
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Cruvz-SRT Streaming Platform</h1>
            <p class="subtitle">Six Sigma Production Environment - Real User Testing</p>
            <div id="globalStatus">
                <span class="status-indicator status-warning"></span>
                Checking system status...
            </div>
        </div>

        <div class="section">
            <h2>üìä System Health Dashboard</h2>
            <div class="grid">
                <div class="metric-card">
                    <div class="value" id="backendStatus">--</div>
                    <div class="label">Backend API</div>
                </div>
                <div class="metric-card">
                    <div class="value" id="streamingStatus">--</div>
                    <div class="label">Streaming Services</div>
                </div>
                <div class="metric-card">
                    <div class="value" id="responseTime">--</div>
                    <div class="label">Response Time (ms)</div>
                </div>
                <div class="metric-card">
                    <div class="value" id="sigmaLevel">--</div>
                    <div class="label">Sigma Level</div>
                </div>
            </div>
            <button onclick="refreshSystemStatus()">üîÑ Refresh Status</button>
            <div id="systemResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üë§ User Authentication</h2>
            <div class="tab-buttons">
                <div class="tab-btn active" onclick="showAuthTab('register')">Register</div>
                <div class="tab-btn" onclick="showAuthTab('login')">Login</div>
            </div>
            
            <div id="registerSection" class="auth-section active">
                <div class="form-group">
                    <label for="regName">Full Name</label>
                    <input type="text" id="regName" placeholder="Enter your full name" value="Test User">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email Address</label>
                    <input type="email" id="regEmail" placeholder="Enter your email" value="">
                </div>
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" placeholder="Enter a strong password" value="TestPass123!">
                </div>
                <button onclick="register()">üöÄ Create Account</button>
            </div>

            <div id="loginSection" class="auth-section">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" value="">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" value="TestPass123!">
                </div>
                <button onclick="login()">üîê Sign In</button>
            </div>
            
            <div id="authResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üì° Live Stream Management</h2>
            <div class="form-group">
                <label for="streamTitle">Stream Title</label>
                <input type="text" id="streamTitle" placeholder="Enter stream title" value="Live Production Stream">
            </div>
            <div class="form-group">
                <label for="streamDesc">Description</label>
                <textarea id="streamDesc" placeholder="Describe your stream" rows="3">Professional live streaming for Six Sigma production validation</textarea>
            </div>
            <div class="form-group">
                <label for="streamProtocol">Streaming Protocol</label>
                <select id="streamProtocol">
                    <option value="rtmp">RTMP (Real-Time Messaging Protocol)</option>
                    <option value="webrtc">WebRTC (Web Real-Time Communication)</option>
                    <option value="srt">SRT (Secure Reliable Transport)</option>
                </select>
            </div>
            <button onclick="createStream()" id="createStreamBtn">üé¨ Create Stream</button>
            <button onclick="loadUserStreams()" id="loadStreamsBtn">üìã Load My Streams</button>
            <div id="streamResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üìà Analytics & Monitoring</h2>
            <button onclick="getAnalytics()">üìä Load Dashboard Metrics</button>
            <button onclick="getPerformanceMetrics()">‚ö° Performance Analysis</button>
            <div id="analyticsResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üß™ Six Sigma Quality Validation</h2>
            <p>Run comprehensive tests to validate production readiness and quality metrics.</p>
            <button onclick="runSixSigmaTests()" id="sixSigmaBtn">üéØ Execute Six Sigma Tests</button>
            <button onclick="runPerformanceTest()">‚ö° Performance Stress Test</button>
            <button onclick="runSecurityTest()">üõ°Ô∏è Security Validation</button>
            <div id="sixSigmaResult" class="result"></div>
        </div>
    </div>

    <script>
        let authToken = '';
        let currentUser = null;
        const API_BASE = 'http://localhost:5000';

        // Generate unique email for testing
        function generateTestEmail() {
            const timestamp = new Date().getTime();
            return `sixsigma_${timestamp}@production.test`;
        }

        // Initialize with unique email
        document.getElementById('regEmail').value = generateTestEmail();
        document.getElementById('loginEmail').value = generateTestEmail();

        async function apiCall(endpoint, options = {}) {
            const startTime = performance.now();
            try {
                const response = await fetch(API_BASE + endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken && { 'Authorization': 'Bearer ' + authToken }),
                        ...options.headers
                    },
                    ...options
                });
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                
                let data = null;
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    data = { text: await response.text() };
                }
                
                return { status: response.status, data, responseTime };
            } catch (error) {
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);
                return { status: 0, error: error.message, responseTime };
            }
        }

        function showAuthTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.auth-section').forEach(section => section.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Section').classList.add('active');
        }

        function updateGlobalStatus(healthy, message) {
            const indicator = document.querySelector('#globalStatus .status-indicator');
            const statusText = document.querySelector('#globalStatus');
            
            if (healthy) {
                indicator.className = 'status-indicator status-healthy';
                statusText.innerHTML = '<span class="status-indicator status-healthy"></span>' + message;
            } else {
                indicator.className = 'status-indicator status-error';
                statusText.innerHTML = '<span class="status-indicator status-error"></span>' + message;
            }
        }

        async function refreshSystemStatus() {
            const result = await apiCall('/health');
            const backendStatus = document.getElementById('backendStatus');
            const responseTime = document.getElementById('responseTime');
            const systemResult = document.getElementById('systemResult');
            
            if (result.status === 200) {
                backendStatus.textContent = '‚úÖ Healthy';
                responseTime.textContent = result.responseTime;
                updateGlobalStatus(true, 'All systems operational');
                
                // Test streaming ports
                await testStreamingPorts();
                
                systemResult.className = 'result success';
                systemResult.innerHTML = '‚úÖ All systems operational<br>Backend: ' + 
                                        result.data.service + ' v' + result.data.version;
            } else {
                backendStatus.textContent = '‚ùå Error';
                responseTime.textContent = result.responseTime || '--';
                updateGlobalStatus(false, 'System issues detected');
                
                systemResult.className = 'result error';
                systemResult.innerHTML = '‚ùå System health check failed: ' + 
                                        (result.error || 'Unknown error');
            }
        }

        async function testStreamingPorts() {
            const streamingStatus = document.getElementById('streamingStatus');
            let healthyPorts = 0;
            const totalPorts = 3;
            
            // Test each streaming port
            const ports = [
                { port: 1935, name: 'RTMP' },
                { port: 3333, name: 'WebRTC' },
                { port: 9999, name: 'SRT' }
            ];
            
            for (const { port, name } of ports) {
                try {
                    const response = await fetch(`http://localhost:${port}`);
                    if (response.ok) {
                        healthyPorts++;
                    }
                } catch (error) {
                    // Port not accessible
                }
            }
            
            streamingStatus.textContent = `${healthyPorts}/${totalPorts} Active`;
        }

        async function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email || !password) {
                showResult('authResult', 'error', '‚ùå All fields are required');
                return;
            }

            const result = await apiCall('/api/auth/register', {
                method: 'POST',
                body: JSON.stringify({ name, email, password })
            });

            const resultDiv = document.getElementById('authResult');
            if (result.status === 201 && result.data.success) {
                authToken = result.data.data.token;
                currentUser = result.data.data.user;
                
                showResult('authResult', 'success', 
                    '‚úÖ Registration successful!<br>' +
                    '<strong>User:</strong> ' + currentUser.email + '<br>' +
                    '<strong>Name:</strong> ' + currentUser.first_name + ' ' + currentUser.last_name);
                
                // Copy email to login form
                document.getElementById('loginEmail').value = email;
                
            } else {
                showResult('authResult', 'error', 
                    '‚ùå Registration failed: ' + (result.data?.error || result.error || 'Unknown error'));
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showResult('authResult', 'error', '‚ùå Email and password are required');
                return;
            }

            const result = await apiCall('/api/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });

            if (result.status === 200 && result.data.success) {
                authToken = result.data.data.token;
                currentUser = result.data.data.user;
                
                showResult('authResult', 'success', 
                    '‚úÖ Login successful!<br>' +
                    '<strong>Welcome back:</strong> ' + currentUser.email);
                    
            } else {
                showResult('authResult', 'error', 
                    '‚ùå Login failed: ' + (result.data?.error || result.error || 'Unknown error'));
            }
        }

        async function createStream() {
            if (!authToken) {
                showResult('streamResult', 'error', '‚ùå Please login first');
                return;
            }

            const title = document.getElementById('streamTitle').value;
            const description = document.getElementById('streamDesc').value;
            const protocol = document.getElementById('streamProtocol').value;

            if (!title) {
                showResult('streamResult', 'error', '‚ùå Stream title is required');
                return;
            }

            const result = await apiCall('/api/streams', {
                method: 'POST',
                body: JSON.stringify({ title, description, protocol })
            });

            if (result.status === 201 && result.data.success) {
                const stream = result.data.data.stream;
                const streamKey = stream.stream_key;
                
                const urlsHtml = '<div class="streaming-urls">' +
                    '<strong>üé¨ Your Streaming URLs:</strong><br>' +
                    '<div class="url-box">' +
                        '<div class="label">RTMP URL:</div>' +
                        'rtmp://localhost:1935/app/' + streamKey +
                        '<button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>' +
                    '</div>' +
                    '<div class="url-box">' +
                        '<div class="label">WebRTC URL:</div>' +
                        'http://localhost:3333/app/' + streamKey +
                        '<button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>' +
                    '</div>' +
                    '<div class="url-box">' +
                        '<div class="label">SRT URL:</div>' +
                        'srt://localhost:9999?streamid=app/' + streamKey +
                        '<button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>' +
                    '</div>' +
                    '</div>';

                showResult('streamResult', 'success', 
                    '‚úÖ Stream created successfully!<br>' +
                    '<strong>Stream ID:</strong> ' + stream.id + '<br>' +
                    '<strong>Protocol:</strong> ' + protocol.toUpperCase() + '<br>' +
                    urlsHtml);
                    
            } else {
                showResult('streamResult', 'error', 
                    '‚ùå Stream creation failed: ' + (result.data?.error || result.error || 'Unknown error'));
            }
        }

        async function loadUserStreams() {
            if (!authToken) {
                showResult('streamResult', 'error', '‚ùå Please login first');
                return;
            }

            const result = await apiCall('/api/streams');
            
            if (result.status === 200 && result.data.success) {
                const streams = result.data.data.streams;
                
                if (streams.length === 0) {
                    showResult('streamResult', 'info', '‚ÑπÔ∏è No streams found. Create your first stream above!');
                } else {
                    let streamsHtml = '<strong>üìã Your Streams:</strong><br>';
                    streams.forEach(stream => {
                        streamsHtml += `<div style="background: #f8f9fa; padding: 10px; margin: 8px 0; border-radius: 5px;">
                            <strong>${stream.title}</strong> (${stream.protocol.toUpperCase()})<br>
                            <small>Status: ${stream.status} | Created: ${new Date(stream.created_at).toLocaleDateString()}</small>
                        </div>`;
                    });
                    
                    showResult('streamResult', 'success', streamsHtml);
                }
            } else {
                showResult('streamResult', 'error', 
                    '‚ùå Failed to load streams: ' + (result.data?.error || result.error || 'Unknown error'));
            }
        }

        async function getAnalytics() {
            if (!authToken) {
                showResult('analyticsResult', 'error', '‚ùå Please login first');
                return;
            }

            const result = await apiCall('/api/analytics/dashboard');
            
            if (result.status === 200 && result.data.success) {
                const analytics = result.data.data;
                showResult('analyticsResult', 'success', 
                    'üìä <strong>Dashboard Analytics:</strong><br>' +
                    '‚Ä¢ Total Streams: ' + analytics.total_streams + '<br>' +
                    '‚Ä¢ Active Streams: ' + analytics.active_streams + '<br>' +
                    '‚Ä¢ Total Users: ' + analytics.total_users + '<br>' +
                    '‚Ä¢ Total Views: ' + analytics.total_views + '<br>' +
                    '‚Ä¢ System Uptime: ' + analytics.uptime);
            } else {
                showResult('analyticsResult', 'error', 
                    '‚ùå Analytics failed: ' + (result.data?.error || result.error || 'Unknown error'));
            }
        }

        async function getPerformanceMetrics() {
            const startTime = performance.now();
            const result = await apiCall('/health');
            const endTime = performance.now();
            
            const timing = Math.round(endTime - startTime);
            
            showResult('analyticsResult', 'info', 
                '‚ö° <strong>Performance Metrics:</strong><br>' +
                '‚Ä¢ API Response Time: ' + timing + 'ms<br>' +
                '‚Ä¢ Performance Grade: ' + (timing < 100 ? 'Excellent' : timing < 300 ? 'Good' : 'Needs Improvement') + '<br>' +
                '‚Ä¢ Six Sigma Compliance: ' + (timing < 500 ? '‚úÖ Pass' : '‚ùå Fail'));
        }

        async function runSixSigmaTests() {
            const btn = document.getElementById('sixSigmaBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Running Tests...';
            
            showResult('sixSigmaResult', 'info', 'üß™ Executing comprehensive Six Sigma validation...');

            let testsPassed = 0;
            let testsTotal = 0;
            let results = [];

            // Test 1: System Health
            testsTotal++;
            const healthTest = await apiCall('/health');
            if (healthTest.status === 200) {
                testsPassed++;
                results.push('‚úÖ System Health Check: PASS');
            } else {
                results.push('‚ùå System Health Check: FAIL');
            }

            // Test 2: Authentication Flow
            if (authToken) {
                testsTotal++;
                testsPassed++;
                results.push('‚úÖ Authentication Flow: PASS');
            } else {
                testsTotal++;
                results.push('‚ùå Authentication Flow: FAIL (not authenticated)');
            }

            // Test 3: API Performance
            testsTotal++;
            if (healthTest.responseTime < 500) {
                testsPassed++;
                results.push('‚úÖ API Performance (<500ms): PASS (' + healthTest.responseTime + 'ms)');
            } else {
                results.push('‚ùå API Performance: FAIL (' + healthTest.responseTime + 'ms)');
            }

            // Test 4: Streaming Services
            testsTotal += 3;
            const streamingTests = await Promise.all([
                fetch('http://localhost:1935').catch(() => ({ ok: false })),
                fetch('http://localhost:3333').catch(() => ({ ok: false })),
                fetch('http://localhost:9999').catch(() => ({ ok: false }))
            ]);
            
            const protocols = ['RTMP', 'WebRTC', 'SRT'];
            streamingTests.forEach((test, index) => {
                if (test.ok) {
                    testsPassed++;
                    results.push(`‚úÖ ${protocols[index]} Service: PASS`);
                } else {
                    results.push(`‚ùå ${protocols[index]} Service: FAIL`);
                }
            });

            // Test 5: Security
            testsTotal++;
            const securityTest = await apiCall('/api/streams', { method: 'GET' });
            if (securityTest.status === 401) {
                testsPassed++;
                results.push('‚úÖ Security Protection: PASS');
            } else {
                results.push('‚ùå Security Protection: FAIL');
            }

            // Calculate Six Sigma metrics
            const successRate = (testsPassed / testsTotal) * 100;
            const defectRate = testsTotal - testsPassed;
            const dpmo = Math.round((defectRate / testsTotal) * 1000000);
            
            let sigmaLevel = '6.0';
            if (dpmo > 3) sigmaLevel = '5.0';
            if (dpmo > 230) sigmaLevel = '4.0';
            if (dpmo > 6210) sigmaLevel = '3.0';
            if (dpmo > 66800) sigmaLevel = '2.0';

            // Update sigma level display
            document.getElementById('sigmaLevel').textContent = sigmaLevel + 'œÉ';

            const resultHtml = '<div class="streaming-urls">' +
                '<strong>üéØ Six Sigma Test Results:</strong><br>' +
                results.join('<br>') + '<br><br>' +
                '<strong>üìä Quality Metrics:</strong><br>' +
                '‚Ä¢ Tests Passed: ' + testsPassed + '/' + testsTotal + '<br>' +
                '‚Ä¢ Success Rate: ' + successRate.toFixed(1) + '%<br>' +
                '‚Ä¢ DPMO: ' + dpmo + '<br>' +
                '‚Ä¢ Sigma Level: ' + sigmaLevel + 'œÉ<br>' +
                '<br>' +
                (defectRate === 0 ? 
                    '<span style="color: #28a745; font-weight: bold;">üèÜ ZERO DEFECTS ACHIEVED - PRODUCTION READY!</span>' : 
                    '<span style="color: #dc3545; font-weight: bold;">‚ùå ' + defectRate + ' defects found - fixes required</span>') +
                '</div>';

            showResult('sixSigmaResult', defectRate === 0 ? 'success' : 'error', resultHtml);
            
            btn.disabled = false;
            btn.innerHTML = 'üéØ Execute Six Sigma Tests';
        }

        async function runPerformanceTest() {
            showResult('sixSigmaResult', 'info', '‚ö° Running performance stress test...');
            
            const iterations = 10;
            const times = [];
            
            for (let i = 0; i < iterations; i++) {
                const result = await apiCall('/health');
                times.push(result.responseTime);
            }
            
            const avgTime = Math.round(times.reduce((a, b) => a + b, 0) / iterations);
            const maxTime = Math.max(...times);
            const minTime = Math.min(...times);
            
            showResult('sixSigmaResult', 'info', 
                '‚ö° <strong>Performance Test Results:</strong><br>' +
                '‚Ä¢ Average Response Time: ' + avgTime + 'ms<br>' +
                '‚Ä¢ Min Response Time: ' + minTime + 'ms<br>' +
                '‚Ä¢ Max Response Time: ' + maxTime + 'ms<br>' +
                '‚Ä¢ Performance Rating: ' + (avgTime < 200 ? 'Excellent' : avgTime < 500 ? 'Good' : 'Needs Improvement'));
        }

        async function runSecurityTest() {
            showResult('sixSigmaResult', 'info', 'üõ°Ô∏è Running security validation...');
            
            let securityPassed = 0;
            let securityTotal = 0;
            
            // Test unauthorized access
            securityTotal++;
            const unauthorizedTest = await apiCall('/api/streams');
            if (unauthorizedTest.status === 401) {
                securityPassed++;
            }
            
            // Test SQL injection protection
            securityTotal++;
            const sqlTest = await apiCall('/api/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email: "test'--", password: "test" })
            });
            if (sqlTest.status === 400 || sqlTest.status === 401) {
                securityPassed++;
            }
            
            const securityRate = (securityPassed / securityTotal) * 100;
            
            showResult('sixSigmaResult', securityPassed === securityTotal ? 'success' : 'warning',
                'üõ°Ô∏è <strong>Security Test Results:</strong><br>' +
                '‚Ä¢ Security Tests Passed: ' + securityPassed + '/' + securityTotal + '<br>' +
                '‚Ä¢ Security Score: ' + securityRate + '%<br>' +
                '‚Ä¢ Status: ' + (securityPassed === securityTotal ? '‚úÖ Secure' : '‚ö†Ô∏è Review Required'));
        }

        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = 'result ' + type;
            element.innerHTML = message;
        }

        function copyToClipboard(button) {
            const urlBox = button.parentElement;
            const url = urlBox.textContent.replace('Copy', '').split('\n')[1].trim();
            
            navigator.clipboard.writeText(url).then(() => {
                button.textContent = 'Copied!';
                button.style.background = '#28a745';
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.style.background = '#4A90E2';
                }, 2000);
            });
        }

        // Initialize
        refreshSystemStatus();
    </script>
</body>
</html>